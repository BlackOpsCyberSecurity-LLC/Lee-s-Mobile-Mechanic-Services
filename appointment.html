<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Book Appointment</title>
  <link rel="stylesheet" href="https://r.mobirisesite.com/1997632/assets/bootstrap/css/bootstrap.min.css">
  <style>
    body { font-family: Arial, sans-serif; }
    .form-section { background: #f8f9fa; padding: 2rem; border-radius: 8px; max-width: 900px; margin: 2rem auto; }
    select.form-select, input.form-control { border: 2px solid #000; height: 52px; font-size: 1.1rem; font-weight: 500; }
    .submit-btn { background-color: #00aaff; color: #fff; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.2rem; }
    .submit-btn:hover { background-color: #0088cc; }
    #success-message { display: none; margin-top: 1rem; color: green; font-weight: bold; text-align: center; }
    #vin-error { color: red; margin-top: 0.5rem; display: none; }
  </style>
</head>
<body>

<div class="form-section">
  <h2>Book Your Appointment</h2>
  <form id="appointment-form" action="https://usebasin.com/f/d459393c2dd6" method="POST">

    <div class="mb-3">
      <label>Full Name</label>
      <input name="full_name" type="text" class="form-control" required>
    </div>
    <div class="mb-3">
      <label>Email</label>
      <input name="email" type="email" class="form-control" required>
    </div>
    <div class="mb-3">
      <label>Phone</label>
      <input name="phone" type="tel" class="form-control" required>
    </div>

    <div class="mb-3">
      <label>VIN Lookup</label>
      <div class="input-group">
        <input type="text" id="vin" class="form-control" placeholder="Enter VIN" maxlength="17">
        <button type="button" id="lookup-vin" class="btn btn-secondary">Lookup VIN</button>
      </div>
      <div id="vin-error">VIN not found</div>
      <input type="hidden" name="vin" id="vin-hidden">
    </div>

    <div class="mb-3">
      <label>Year</label>
      <select id="year" name="vehicle_year" class="form-select"><option value="">Select Year</option></select>
    </div>
    <div class="mb-3">
      <label>Make</label>
      <select id="make" name="vehicle_make" class="form-select"><option value="">Select Make</option></select>
    </div>
    <div class="mb-3">
      <label>Model</label>
      <select id="model" name="vehicle_model" class="form-select"><option value="">Select Model</option></select>
    </div>

    <button type="submit" class="submit-btn">Submit</button>
    <div id="success-message">Your appointment has been submitted successfully!</div>
  </form>
</div>

<script>
  let vehicleData = {};
  const yearSelect = document.getElementById('year');
  const makeSelect = document.getElementById('make');
  const modelSelect = document.getElementById('model');
  const vinInput = document.getElementById('vin');
  const vinBtn = document.getElementById('lookup-vin');
  const vinError = document.getElementById('vin-error');
  const vinHidden = document.getElementById('vin-hidden');

  fetch('vehicles_us.json')
    .then(resp => resp.json())
    .then(data => {
      vehicleData = data;
      Object.keys(vehicleData).sort((a,b)=>b-a).forEach(y=>{
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y; yearSelect.appendChild(opt);
      });
    });

  yearSelect.addEventListener('change', function(){
    makeSelect.innerHTML = '<option value="">Select Make</option>';
    modelSelect.innerHTML = '<option value="">Select Model</option>';
    const year = this.value;
    if(!year || !vehicleData[year]) return;
    Object.keys(vehicleData[year]).sort().forEach(make=>{
      const opt = document.createElement('option'); opt.value=make; opt.textContent=make;
      makeSelect.appendChild(opt);
    });
  });

  makeSelect.addEventListener('change', function(){
    modelSelect.innerHTML = '<option value="">Select Model</option>';
    const year = yearSelect.value;
    const make = this.value;
    if(!year || !make || !vehicleData[year][make]) return;
    vehicleData[year][make].sort().forEach(model=>{
      const opt = document.createElement('option'); opt.value=model; opt.textContent=model;
      modelSelect.appendChild(opt);
    });
  });

  vinBtn.addEventListener('click', function(){
    const vin = vinInput.value.trim();
    vinError.style.display = 'none';
    vinHidden.value = vin;
    if(vin.length !== 17) { vinError.textContent = 'VIN must be 17 characters'; vinError.style.display='block'; return; }

    // Find vehicle by VIN substring match (simplest demo)
    let found=false;
    outer: for(const y in vehicleData){
      for(const m in vehicleData[y]){
        for(const mod of vehicleData[y][m]){
          if(vin.toLowerCase().includes(mod.toLowerCase().slice(0,3))){
            yearSelect.value = y; yearSelect.dispatchEvent(new Event('change'));
            makeSelect.value = m; makeSelect.dispatchEvent(new Event('change'));
            modelSelect.value = mod;
            found = true; break outer;
          }
        }
      }
    }
    if(!found){ vinError.textContent='Vehicle not found'; vinError.style.display='block'; }
  });

  document.getElementById('appointment-form').addEventListener('submit', function(){
    setTimeout(function(){
      document.getElementById('success-message').style.display='block';
      document.getElementById('appointment-form').reset();
    }, 500);
  });
</script>
</body>
</html>
